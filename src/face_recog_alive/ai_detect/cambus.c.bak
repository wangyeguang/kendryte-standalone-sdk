#include "cambus.h"
#include "dvp.h"
#include "gc0328.h"
#include "sysctl.h"
#include "fpioa.h"
#include "sipeed_i2c.h"

static uint32_t write_bus_delay = 10; //ms
static int8_t i2c_device = -2;
static int8_t i2c_device0 = -2;
static int8_t i2c_device1 = -2;
static int8_t i2c_pin_clk = 41;
static  int8_t i2c_pin_sda = 42;
static uint8_t i2c_gpio_clk = 41;
static uint8_t i2c_gpio_sda = 40;

void cambus_set_writeb_delay(uint32_t delay)
{
    write_bus_delay = delay;
}


static uint8_t sccb_reg_width = 8;


/**
 * 
 * @i2c_type 0: sccb, 1:hardware i2c, 2:software i2c
 * 
 */
int cambus_init(uint8_t reg_wid, int8_t i2c, int8_t pin_clk, int8_t pin_sda, uint8_t gpio_clk, uint8_t gpio_sda)
{
    dvp_init(reg_wid);
    sccb_reg_width = reg_wid;
    if (pin_clk < 0 || pin_sda < 0)
        return -1;
    i2c_device0 = 0;//2
    i2c_device1 = 1;//1
    // if(i2c_device == -2)
    // i2c_device = i2c_device0;
    i2c_device=i2c_device0;
    i2c_pin_clk = pin_clk;
    i2c_pin_sda = pin_sda;
    i2c_gpio_clk = gpio_clk;
    i2c_gpio_sda = gpio_sda;
    sccb_i2c_init(2, pin_clk, pin_sda, gpio_clk, gpio_sda, 100000);
    return 0;
}



uint8_t cambus_reg_width()
{
    return sccb_reg_width;
}

int cambus_shutdown(int select)
{
    if(select == 0)
    {
        i2c_device = i2c_device0;   
    }
    else if(select == 1)
    {
        i2c_device = i2c_device1;
    }
    sccb_i2c_init(2,i2c_pin_clk,i2c_pin_sda,i2c_gpio_clk,i2c_gpio_sda,100000);
    // systick_sleep(10);
    return 0;
}